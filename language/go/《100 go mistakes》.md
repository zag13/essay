# 《100 go mistakes》

[思维导图](/mind.html?path=/language/go/《100%20go%20mistakes》)

## 代码和项目组织

1. **意外的变量隐藏** 要注意短声明是否会覆盖原先变量
2. **不必要的嵌套代码** 简单可读，尽早返回
3. **滥用 init 函数** init 在变量声明之后，main 函数之前执行，多个 init 函数按照声明顺序执行
4. **过度使用 getter 和 setter** 尽量使用直接访问，不要过度封装
5. **接口污染** 若无必要，勿增实体（抽象应该是被发现，而不是被创建）
6. **生产者的接口** 一般放在消费端维护，若确有必要放在生产者一方，应尽量减小抽象
7. **返回接口** 一般返回具体抽象
8. **any 意味着 nothing** any 丢失了类型信息，使用时应谨慎
9. **乱用泛型** 应在一些通用的数据结构和函数中使用
10. **误用嵌入类型** 小心方法提升
11. **不使用函数选项模式** 萝卜青菜，各有所爱
12. **项目无组织** 社区公约 golang-standards
13. **创建通用包** 不推荐 common、util、shared 等没有具体含义的包
14. **变量和包名冲突** 小心变量和包名冲突
15. **缺少代码文档** 每个导出的元素都应有文档
16. **不使用 linters** 磨刀不误砍柴工

## 数据类型

17. **使用 8 进制字面量** 二进制：`0b`，八进制：`0o`，十六进制：`0x`
18. **忽略整数溢出** Go 对溢出是静默的
19. **不了解浮点数** float32 精度 7 位，float64 精度 15 位
20. **不了解切片的长度和容量** 长度是指切片中元素的个数，容量是指底层数组中元素的个数
21. **低效的切片初始化** 初始化时指定容量，避免频繁扩容
22. **对 nil 和空切片的困惑** nil 和空切片的长度都为0，nil 不需要分配
23. **不正确检查切片为空** `len(s) != 0`
24. **不正确复制切片** `copy(dst, src)` 会复制 `min(len(dst), len(src))` 个元素
25. **忽视 append 的副作用** append 可能会导致底层数组重新分配，导致之前的切片失效
26. **切片内存泄露** 切片容量泄漏、底层数组泄漏
27. **低效的 map 初始化** 初始化时指定容量，避免频繁扩容
28. **map 内存泄漏** map 的桶会随着元素的增加而增加，但是不会随着元素的删除而减少
29. **比较值时犯错** `reflect.DeepEqual()`

## 控制结构

30. **忽视遍历时元素被复制** for range 时，元素会被复制，修改的是副本
31. **忽视遍历时参数怎么计算** for range 时，参数只会计算一次；若需要每次都计算，应使用普通 for 循环